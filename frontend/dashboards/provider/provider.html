<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UrbanEase - Provider Dashboard</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Global Styles -->
    <link rel="stylesheet" href="/frontend/Home-page and Signup/styles.css">
    <!-- Provider Styles -->
    <link rel="stylesheet" href="/frontend/dashboards/provider/provider-styles.css">
</head>
<body>

    <!-- Mobile Topbar -->
    <div class="admin-topbar d-lg-none">
        <button class="sidebar-toggle" id="sidebarToggle" aria-label="Toggle sidebar">
            <i class="fas fa-bars"></i>
        </button>
        <span class="topbar-brand"><i class="fas fa-city me-2"></i>UrbanEase</span>
    </div>

    <!-- Sidebar Overlay (mobile) -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <!-- Sidebar -->
    <aside class="admin-sidebar" id="providerSidebar">
        <div class="sidebar-header">
            <a href="#" class="sidebar-brand" id="brandLink"><i class="fas fa-city me-2"></i>UrbanEase</a>
            <span class="sidebar-subtitle">Provider Panel</span>
        </div>
        <nav class="sidebar-nav">
            <ul class="sidebar-menu">
                <li>
                    <a href="#" class="sidebar-link active" data-section="dashboard" id="dashboardLink">
                        <i class="fas fa-tachometer-alt"></i><span>Dashboard</span>
                    </a>
                </li>
                <li class="sidebar-divider"></li>
                <li>
                    <a href="#" class="sidebar-link requires-verification" data-section="house-listings" title="Complete verification to unlock">
                        <i class="fas fa-home"></i><span>My House Listings</span>
                    </a>
                </li>
                <li>
                    <a href="#" class="sidebar-link requires-verification" data-section="tiffin-listings" title="Complete verification to unlock">
                        <i class="fas fa-utensils"></i><span>My Tiffin Listings</span>
                    </a>
                </li>
                <li>
                    <a href="#" class="sidebar-link requires-verification" data-section="service-listings" title="Complete verification to unlock">
                        <i class="fas fa-tools"></i><span>My Services</span>
                    </a>
                </li>
                <li class="sidebar-divider"></li>
                <li>
                    <a href="#" class="sidebar-link requires-verification" data-section="food-orders" title="Complete verification to unlock">
                        <i class="fas fa-shopping-bag"></i><span>Food Orders</span>
                    </a>
                </li>
                <li>
                    <a href="#" class="sidebar-link requires-verification" data-section="service-bookings" title="Complete verification to unlock">
                        <i class="fas fa-calendar-check"></i><span>Service Bookings</span>
                    </a>
                </li>
                <li class="sidebar-divider"></li>
                <li>
                    <a href="#" class="sidebar-link" data-section="profile">
                        <i class="fas fa-user"></i><span>Profile</span>
                    </a>
                </li>
                <li>
                    <a href="/provider/logout" class="sidebar-link sidebar-logout">
                        <i class="fas fa-sign-out-alt"></i><span>Logout</span>
                    </a>
                </li>
            </ul>
        </nav>
    </aside>

    <!-- Main Content -->
    <main class="admin-main">

        <!-- Status Banners (shown based on verification status) -->
        <div id="status-banner-container"></div>

        <!-- Dashboard Section -->
        <section class="admin-section active" id="section-dashboard">
            <div class="section-header">
                <h1 class="admin-page-title">Dashboard</h1>
                <p class="text-muted">Welcome to your provider dashboard.</p>
            </div>
            
            <!-- Verification Required Content (shown if not verified) -->
            <div id="verification-required-content" style="display: none;">
                <div class="verification-card">
                    <div class="verification-card-header">
                        <i class="fas fa-user-check"></i>
                        <h3>Provider Verification</h3>
                    </div>
                    <p class="text-muted mb-4">Complete your verification to start offering services on UrbanEase.</p>
                    
                    <form id="verification-form" enctype="multipart/form-data">
                        <div class="row">
                            <div class="col-12 mb-3">
                                <label for="business_name" class="form-label">Business Name <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="business_name" name="business_name" placeholder="Enter your business name" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="aadhaar_number" class="form-label">Aadhaar Number <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="aadhaar_number" name="aadhaar_number" placeholder="Enter 12-digit Aadhaar number" maxlength="12" pattern="[0-9]{12}" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="business_license" class="form-label">Business License (Optional)</label>
                                <input type="text" class="form-control" id="business_license" name="business_license" placeholder="License number if applicable">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="phone" class="form-label">Phone Number</label>
                                <input type="text" class="form-control" id="phone" name="phone" readonly>
                                <small class="text-muted">Phone from your registered account</small>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="profile_photo" class="form-label">Profile Photo (JPEG only)</label>
                                <div class="file-upload-wrapper">
                                    <input type="file" class="form-control" id="profile_photo" name="profile_photo" accept="image/jpeg,image/jpg">
                                </div>
                                <div id="image-preview-container" class="mt-2" style="display: none;">
                                    <img id="image-preview" src="" alt="Preview" class="image-preview">
                                </div>
                            </div>
                        </div>
                        <div class="mt-4">
                            <button type="submit" class="btn btn-primary btn-lg" id="submit-verification">
                                <i class="fas fa-paper-plane me-2"></i>Submit for Verification
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Verified Dashboard Content (shown if verified) -->
            <div id="verified-dashboard-content" style="display: none;">
                <div class="row g-4">
                    <div class="col-sm-6 col-xl-3">
                        <div class="summary-card">
                            <div class="summary-icon" style="background-color: var(--primary);">
                                <i class="fas fa-home" style="color: var(--primary-dark);"></i>
                            </div>
                            <div class="summary-info">
                                <span class="summary-label">House Listings</span>
                                <span class="summary-value" id="house-count">0</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-6 col-xl-3">
                        <div class="summary-card">
                            <div class="summary-icon" style="background-color: var(--secondary);">
                                <i class="fas fa-utensils" style="color: var(--secondary-dark);"></i>
                            </div>
                            <div class="summary-info">
                                <span class="summary-label">Tiffin Listings</span>
                                <span class="summary-value" id="tiffin-count">0</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-6 col-xl-3">
                        <div class="summary-card">
                            <div class="summary-icon" style="background-color: var(--accent);">
                                <i class="fas fa-tools" style="color: #059669;"></i>
                            </div>
                            <div class="summary-info">
                                <span class="summary-label">Service Listings</span>
                                <span class="summary-value" id="service-count">0</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-6 col-xl-3">
                        <div class="summary-card" id="active-food-orders-card" style="cursor: pointer;">
                            <div class="summary-icon" style="background-color: #FDE68A;">
                                <i class="fas fa-shopping-bag" style="color: #D97706;"></i>
                            </div>
                            <div class="summary-info">
                                <span class="summary-label">Active Food Orders</span>
                                <span class="summary-value" id="food-order-count">0</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-6 col-xl-3">
                        <div class="summary-card" id="active-service-bookings-card" style="cursor: pointer;">
                            <div class="summary-icon" style="background-color: #BFDBFE;">
                                <i class="fas fa-calendar-check" style="color: #2563EB;"></i>
                            </div>
                            <div class="summary-info">
                                <span class="summary-label">Active Service Bookings</span>
                                <span class="summary-value" id="service-booking-count">0</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- House Listings Section -->
        <section class="admin-section" id="section-house-listings">
            <div class="section-header d-flex justify-content-between align-items-center">
                <div>
                    <h1 class="admin-page-title">My House Listings</h1>
                    <p class="text-muted">Manage your house, PG, and hostel listings.</p>
                </div>
                <!-- Only visible if verification status is verified (handled by JS) -->
                <button class="btn btn-primary" id="add-house-btn" onclick="openAddHouseModal()" style="display: none;">
                    <i class="fas fa-plus me-2"></i>Add New Listing
                </button>
            </div>
            
            <div id="house-listings-container">
                <!-- Content injected by JS -->
                <div class="text-center py-5">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Tiffin Listings Section -->
        <section class="admin-section" id="section-tiffin-listings">
            <div class="section-header d-flex justify-content-between align-items-center">
                <div>
                    <h1 class="admin-page-title">My Tiffin Listings</h1>
                    <p class="text-muted">Manage your tiffin service listings.</p>
                </div>
                <button class="btn btn-primary" id="add-tiffin-btn" onclick="openAddTiffinModal()" style="display: none;">
                    <i class="fas fa-plus me-2"></i>Add New Tiffin Service
                </button>
            </div>
            
            <div id="tiffin-listings-container">
                <!-- Content injected by JS -->
                <div class="text-center py-5">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Service Listings Section -->
        <section class="admin-section" id="section-service-listings">
            <div class="section-header d-flex justify-content-between align-items-center">
                <div>
                    <h1 class="admin-page-title">My Services</h1>
                    <p class="text-muted">Manage your professional services.</p>
                </div>
                <button class="btn btn-primary" id="add-service-btn" onclick="openAddServiceModal()" style="display: none;">
                    <i class="fas fa-plus me-2"></i>Add New Service
                </button>
            </div>
            
            <div id="service-listings-container">
                 <div class="text-center py-5">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Use existing Tiffin Image Modals as pattern for Services? No images for services yet. -->
        <!-- Add Service Modal -->
        <div class="modal fade" id="addServiceModal" tabindex="-1">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Add New Service</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <form id="addServiceForm" onsubmit="startServicePaymentFlow(event)">
                            <div class="mb-3">
                                <label class="form-label">Service Category <span class="text-danger">*</span></label>
                                <select class="form-select" name="service_category" required>
                                    <option value="" selected disabled>Select Category</option>
                                    <option value="electrician">Electrician</option>
                                    <option value="plumber">Plumber</option>
                                    <option value="carpenter">Carpenter</option>
                                    <option value="ac_repair">AC Repair</option>
                                    <option value="cleaning">Cleaning</option>
                                    <option value="packers_movers">Packers & Movers</option>
                                    <option value="wifi_installation">WiFi Installation</option>
                                    <option value="gas_connection">Gas Connection</option>
                                    <option value="laundry">Laundry</option>
                                </select>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">Service Title <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" name="service_title" placeholder="e.g. Expert Electrician" required>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">Description <span class="text-danger">*</span></label>
                                <textarea class="form-control" name="description" rows="3" required></textarea>
                            </div>
                            
                            <div class="row">
                                <div class="col-6 mb-3">
                                    <label class="form-label">Base Price (Per Visit) <span class="text-danger">*</span></label>
                                    <div class="input-group">
                                        <span class="input-group-text">₹</span>
                                        <input type="number" class="form-control" name="base_price" min="0" required>
                                    </div>
                                </div>
                                <div class="col-6 mb-3">
                                    <label class="form-label">Service Radius (km)</label>
                                    <input type="number" class="form-control text-muted" name="service_radius" min="0" value="5">
                                </div>
                            </div>

                            <div class="col-md-12 mb-3">
                                <label class="form-label">Available Days <span class="text-danger">*</span></label>
                                <div class="row row-cols-2 row-cols-md-4 g-2">
                                    <div class="col"><div class="form-check"><input class="form-check-input service-day-check" type="checkbox" value="Monday" id="svc-mon"><label class="form-check-label" for="svc-mon">Monday</label></div></div>
                                    <div class="col"><div class="form-check"><input class="form-check-input service-day-check" type="checkbox" value="Tuesday" id="svc-tue"><label class="form-check-label" for="svc-tue">Tuesday</label></div></div>
                                    <div class="col"><div class="form-check"><input class="form-check-input service-day-check" type="checkbox" value="Wednesday" id="svc-wed"><label class="form-check-label" for="svc-wed">Wednesday</label></div></div>
                                    <div class="col"><div class="form-check"><input class="form-check-input service-day-check" type="checkbox" value="Thursday" id="svc-thu"><label class="form-check-label" for="svc-thu">Thursday</label></div></div>
                                    <div class="col"><div class="form-check"><input class="form-check-input service-day-check" type="checkbox" value="Friday" id="svc-fri"><label class="form-check-label" for="svc-fri">Friday</label></div></div>
                                    <div class="col"><div class="form-check"><input class="form-check-input service-day-check" type="checkbox" value="Saturday" id="svc-sat"><label class="form-check-label" for="svc-sat">Saturday</label></div></div>
                                    <div class="col"><div class="form-check"><input class="form-check-input service-day-check" type="checkbox" value="Sunday" id="svc-sun"><label class="form-check-label" for="svc-sun">Sunday</label></div></div>
                                </div>
                                <input type="hidden" name="availability_days" id="service-days">
                                <div class="invalid-feedback d-block" id="svc-days-error" style="display: none !important;">Please select at least one day.</div>
                            </div>
                            
                            <div class="mt-4 text-end">
                                <button type="button" class="btn btn-secondary me-2" data-bs-dismiss="modal">Cancel</button>
                                <button type="submit" class="btn btn-primary">Submit Listing</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- View Service Modal -->
        <div class="modal fade" id="viewServiceModal" tabindex="-1">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                     <div class="modal-header">
                        <h5 class="modal-title" id="svc-view-title">Service Details</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                     <div class="modal-body">
                         <div class="d-flex justify-content-between align-items-center mb-3">
                             <span id="svc-view-category" class="badge bg-secondary">Category</span>
                             <span id="svc-view-status" class="badge">Status</span>
                         </div>
                         
                         <h4 class="mb-3">₹<span id="svc-view-price">0</span> <small class="text-muted fs-6">per visit</small></h4>
                         
                         <p id="svc-view-desc" class="text-muted mb-4"></p>
                         
                         <div class="row g-3">
                             <div class="col-6">
                                 <small class="text-muted d-block">Service Radius</small>
                                 <strong id="svc-view-radius">0 km</strong>
                             </div>
                              <div class="col-6">
                                 <small class="text-muted d-block">Created On</small>
                                 <strong id="svc-view-created">Date</strong>
                             </div>
                             <div class="col-12">
                                 <small class="text-muted d-block">Available Days</small>
                                 <strong id="svc-view-days">All Days</strong>
                             </div>
                         </div>
                     </div>
                     <div class="modal-footer">
                        <button type="button" class="btn btn-secondary w-100" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
    <!-- Food Orders Section -->
    <section class="admin-section" id="section-food-orders">
        <!-- Main List View -->
        <div id="food-orders-list-view">
            <div class="section-header">
                <h1 class="admin-page-title">Food Orders</h1>
                <p class="text-muted">Manage your kitchens and orders.</p>
            </div>
            
            <div id="food-orders-tiffins-container" class="house-listings-grid">
                 <!-- Tiffin Cards for Orders -->
                 <div class="text-center py-5">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Manage Kitchen View (Hidden by default) -->
        <div id="manage-kitchen-view" style="display: none;">
            <div class="section-header d-flex align-items-center">
                <button class="btn btn-outline-secondary me-3" onclick="closeManageKitchen()">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <div>
                    <h1 class="admin-page-title">Kitchen Management</h1>
                    <p class="text-muted" id="kitchen-manage-title">Manage your kitchen status.</p>
                </div>
            </div>

            <div class="card border-0 shadow-sm">
                <div class="card-body p-4">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h5 class="fw-bold mb-1">Kitchen Status</h5>
                            <p class="text-muted mb-0">Toggle to open or close your kitchen for new orders.</p>
                        </div>
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="kitchen-toggle" style="width: 3em; height: 1.5em; cursor: pointer;">
                        </div>
                    </div>
                    <div class="mt-3">
                        <span id="kitchen-status-badge" class="badge bg-danger rounded-pill px-3 py-2">Kitchen Closed</span>
                    </div>
                </div>
            </div>
            
            <!-- Meals Section -->
            <div class="d-flex justify-content-between align-items-center mt-5 mb-3">
                <h3 class="h5 fw-bold mb-0">Meals Menu</h3>
                <button class="btn btn-primary" onclick="openAddMealModal()">
                    <i class="fas fa-plus me-2"></i>Add Meal
                </button>
            </div>

            <div id="meals-container" class="house-listings-grid">
                <!-- Meals will be loaded here -->
                <div class="text-center py-5 w-100">
                    <p class="text-muted">Loading meals...</p>
                </div>
            </div>
            
            <!-- Orders Section -->
            <div class="d-flex justify-content-between align-items-center mt-5 mb-3">
                <h3 class="h5 fw-bold mb-0">Orders</h3>
                <button class="btn btn-outline-primary btn-sm" onclick="fetchOrders(currentManageTiffinId)">
                    <i class="fas fa-sync-alt me-1"></i>Refresh
                </button>
            </div>

            <div id="orders-container">
                <div class="text-center py-4">
                    <p class="text-muted">Loading orders...</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Order Details Modal -->
    <div class="modal fade" id="orderDetailsModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content border-0 shadow-lg" style="border-radius: var(--radius-xl);">
                <div class="modal-header border-bottom">
                    <h5 class="modal-title fw-bold">Order Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-4">
                    <div class="row g-4">
                        <div class="col-md-6">
                            <p class="mb-2"><strong>Order ID:</strong> <span id="od-id"></span></p>
                            <p class="mb-2"><strong>Customer:</strong> <span id="od-customer"></span></p>
                            <p class="mb-2"><strong>Phone:</strong> <span id="od-phone"></span></p>
                            <p class="mb-2"><strong>Meal:</strong> <span id="od-meal"></span></p>
                            <p class="mb-2"><strong>Category:</strong> <span id="od-category"></span></p>
                            <p class="mb-2"><strong>Diet Type:</strong> <span id="od-diet"></span></p>
                        </div>
                        <div class="col-md-6">
                            <p class="mb-2"><strong>Quantity:</strong> <span id="od-qty"></span></p>
                            <p class="mb-2"><strong>Base Price:</strong> ₹<span id="od-base"></span></p>
                            <p class="mb-2"><strong>Fast Delivery:</strong> <span id="od-fast"></span></p>
                            <p class="mb-2"><strong>Fast Delivery Charge:</strong> ₹<span id="od-fast-charge"></span></p>
                            <p class="mb-2"><strong>Total Price:</strong> <span class="fw-bold text-success">₹<span id="od-total"></span></span></p>
                            <p class="mb-2"><strong>Status:</strong> <span id="od-status"></span></p>
                        </div>
                        <div class="col-12">
                            <p class="mb-2"><strong>Delivery Address:</strong></p>
                            <p class="text-muted mb-2" id="od-address"></p>
                            <p class="mb-0"><strong>Order Date:</strong> <span id="od-date"></span></p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer border-top">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Meal Modal -->
    <div class="modal fade" id="addMealModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg" style="border-radius: var(--radius-xl);">
                <div class="modal-header border-0 pb-0">
                    <h5 class="modal-title fw-bold">Add New Meal</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-4">
                    <form id="addMealForm">
                        <div class="mb-3">
                            <label class="form-label">Meal Name <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" name="meal_name" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Description</label>
                            <textarea class="form-control" name="description" rows="2"></textarea>
                        </div>
                        <div class="row g-3 mb-3">
                            <div class="col-6">
                                <label class="form-label">Category <span class="text-danger">*</span></label>
                                <select class="form-select" name="meal_category" required>
                                    <option value="lunch">Lunch</option>
                                    <option value="dinner">Dinner</option>
                                    <option value="breakfast">Breakfast</option>
                                </select>
                            </div>
                            <div class="col-6">
                                <label class="form-label">Diet Type <span class="text-danger">*</span></label>
                                <div class="d-flex gap-2 mt-2">
                                     <div class="form-check">
                                        <input class="form-check-input" type="radio" name="diet_type" value="veg" checked>
                                        <label class="form-check-label">Veg</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="diet_type" value="non-veg">
                                        <label class="form-check-label">Non-Veg</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row g-3 mb-3">
                            <div class="col-6">
                                <label class="form-label">Price (₹) <span class="text-danger">*</span></label>
                                <input type="number" class="form-control" name="price" min="0" step="0.01" required>
                            </div>
                            <div class="col-6 d-flex align-items-center mt-4">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" name="is_available" id="mealAvailable" checked>
                                    <label class="form-check-label" for="mealAvailable">Available Now</label>
                                </div>
                            </div>
                        </div>
                        <div class="mb-4">
                            <label class="form-label">Meal Image <span class="text-danger">*</span></label>
                            <input type="file" class="form-control" name="meal_image" accept="image/jpeg" required onchange="previewMealImage(this)">
                            <div class="mt-2 text-center" style="display:none;" id="meal-image-preview-container">
                                <img id="meal-image-preview" src="#" alt="Preview" style="max-height: 150px; border-radius: 10px;">
                            </div>
                        </div>
                        <div class="d-grid">
                            <button type="submit" class="btn btn-primary btn-lg">Add Meal</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- View Meal Modal -->
    <div class="modal fade" id="viewMealModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg" style="border-radius: var(--radius-xl);">
                <div class="modal-body p-0">
                    <button type="button" class="btn-close position-absolute top-0 end-0 m-3 bg-white p-2 rounded-circle shadow-sm" data-bs-dismiss="modal" style="z-index: 10; opacity: 1;"></button>
                    <img id="view-meal-image" src="" class="w-100" style="height: 250px; object-fit: cover; border-top-left-radius: var(--radius-xl); border-top-right-radius: var(--radius-xl);">
                    <div class="p-4">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                             <h4 class="fw-bold mb-0" id="view-meal-name">Meal Name</h4>
                             <span class="badge bg-success" id="view-meal-price">₹150</span>
                        </div>
                        <div class="d-flex gap-2 mb-3">
                            <span class="badge bg-secondary" id="view-meal-category">Lunch</span>
                            <span class="badge bg-info text-dark" id="view-meal-diet">Veg</span>
                            <span class="badge bg-light text-dark border" id="view-meal-status">Available</span>
                        </div>
                        <p class="text-muted" id="view-meal-desc">Description goes here...</p>
                        <hr>
                        <div class="text-end">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Meal Modal -->
    <div class="modal fade" id="editMealModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg" style="border-radius: var(--radius-xl);">
                <div class="modal-header border-0 pb-0">
                    <h5 class="modal-title fw-bold">Edit Meal</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-4">
                    <form id="editMealForm">
                        <input type="hidden" name="meal_id" id="edit-meal-id">
                        <div class="mb-3">
                            <label class="form-label">Meal Name <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" name="meal_name" id="edit-meal-name" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Description</label>
                            <textarea class="form-control" name="description" id="edit-meal-desc" rows="2"></textarea>
                        </div>
                        <div class="row g-3 mb-3">
                            <div class="col-6">
                                <label class="form-label">Category <span class="text-danger">*</span></label>
                                <select class="form-select" name="meal_category" id="edit-meal-category" required>
                                    <option value="breakfast">Breakfast</option>
                                    <option value="lunch">Lunch</option>
                                    <option value="dinner">Dinner</option>
                                </select>
                            </div>
                            <div class="col-6">
                                <label class="form-label">Diet Type <span class="text-danger">*</span></label>
                                <div class="d-flex gap-2 mt-2">
                                     <div class="form-check">
                                        <input class="form-check-input" type="radio" name="edit_diet_type" value="veg" id="edit-diet-veg">
                                        <label class="form-check-label" for="edit-diet-veg">Veg</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="edit_diet_type" value="non-veg" id="edit-diet-nonveg">
                                        <label class="form-check-label" for="edit-diet-nonveg">Non-Veg</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row g-3 mb-3">
                            <div class="col-6">
                                <label class="form-label">Price (₹) <span class="text-danger">*</span></label>
                                <input type="number" class="form-control" name="price" id="edit-meal-price" min="0" step="0.01" required>
                            </div>
                            <div class="col-6 d-flex align-items-center mt-4">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" name="is_available" id="editMealAvailable">
                                    <label class="form-check-label" for="editMealAvailable">Available Now</label>
                                </div>
                            </div>
                        </div>
                        <div class="mb-4">
                            <label class="form-label">Update Image (optional)</label>
                            <input type="file" class="form-control" name="meal_image" accept="image/jpeg" onchange="previewEditMealImage(this)">
                            <div class="mt-2 text-center" id="edit-meal-image-preview-container">
                                <img id="edit-meal-image-preview" src="#" alt="Preview" style="max-height: 150px; border-radius: 10px;">
                            </div>
                        </div>
                        <div class="d-grid">
                            <button type="submit" class="btn btn-primary btn-lg">Save Changes</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>


        <!-- Service Bookings Section -->
        <section class="admin-section" id="section-service-bookings">
            <!-- Service Listings View -->
            <div id="service-bookings-list-view">
                <div class="section-header">
                    <h1 class="admin-page-title">Service Bookings</h1>
                    <p class="text-muted">Track and manage your service bookings.</p>
                </div>
                <div id="service-for-bookings-container" class="house-listings-grid">
                    <div class="text-center py-5 w-100">
                        <div class="spinner-border text-primary" role="status"></div>
                    </div>
                </div>
            </div>

            <!-- Manage Services View (hidden by default) -->
            <div id="manage-services-view" style="display: none;">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <div>
                        <button class="btn btn-outline-secondary me-2" onclick="closeManageServices()">
                            <i class="fas fa-arrow-left me-2"></i>Back
                        </button>
                        <h4 class="d-inline-block mb-0" id="manage-services-title">Manage Service</h4>
                    </div>
                </div>

                <!-- Bookings Section -->
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h3 class="h5 fw-bold mb-0">Bookings</h3>
                    <button class="btn btn-outline-primary btn-sm" onclick="fetchServiceBookings(currentManageServiceId)">
                        <i class="fas fa-sync-alt me-1"></i>Refresh
                    </button>
                </div>

                <div id="service-bookings-container">
                    <div class="text-center py-4">
                        <p class="text-muted">Loading bookings...</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Service Booking Details Modal -->
        <div class="modal fade" id="serviceBookingDetailsModal" tabindex="-1">
            <div class="modal-dialog modal-dialog-centered modal-lg">
                <div class="modal-content border-0 shadow-lg" style="border-radius: var(--radius-xl);">
                    <div class="modal-header border-bottom">
                        <h5 class="modal-title fw-bold">Booking Details</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body p-4">
                        <div class="row g-4">
                            <div class="col-md-6">
                                <p class="mb-2"><strong>Booking ID:</strong> <span id="sb-id"></span></p>
                                <p class="mb-2"><strong>Customer:</strong> <span id="sb-customer"></span></p>
                                <p class="mb-2"><strong>Phone:</strong> <span id="sb-phone"></span></p>
                                <p class="mb-2"><strong>Service:</strong> <span id="sb-title"></span></p>
                                <p class="mb-2"><strong>Category:</strong> <span id="sb-category"></span></p>
                                <p class="mb-2"><strong>Booking Date:</strong> <span id="sb-date"></span></p>
                            </div>
                            <div class="col-md-6">
                                <p class="mb-2"><strong>Booking Time:</strong> <span id="sb-time"></span></p>
                                <p class="mb-2"><strong>Quoted Price:</strong> <span class="fw-bold text-success" id="sb-price"></span></p>
                                <p class="mb-2"><strong>Status:</strong> <span id="sb-status"></span></p>
                                <p class="mb-2"><strong>Created:</strong> <span id="sb-created"></span></p>
                            </div>
                            <div class="col-12">
                                <p class="mb-2"><strong>Address:</strong></p>
                                <p class="text-muted mb-2" id="sb-address"></p>
                                <p class="mb-2"><strong>Notes:</strong></p>
                                <p class="text-muted mb-0" id="sb-notes"></p>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer border-top" id="sb-modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>


        <!-- Profile Section -->
        <section class="admin-section" id="section-profile">
            <div class="section-header">
                <h1 class="admin-page-title">Profile</h1>
                <p class="text-muted">View and manage your profile information.</p>
            </div>
            <div class="profile-card">
                <div class="row">
                    <div class="col-md-4 text-center mb-4 mb-md-0">
                        <img id="profile-image" src="" alt="Profile" class="profile-avatar">
                        <h4 id="profile-name" class="mt-3 mb-1">--</h4>
                        <span id="profile-badge" class="badge bg-warning">Pending</span>
                    </div>
                    <div class="col-md-8">
                        <div class="row">
                            <div class="col-sm-6 mb-3">
                                <label class="form-label text-muted small mb-1">Email</label>
                                <p id="profile-email" class="fw-semibold mb-0">--</p>
                            </div>
                            <div class="col-sm-6 mb-3">
                                <label class="form-label text-muted small mb-1">Phone</label>
                                <p id="profile-phone" class="fw-semibold mb-0">--</p>
                            </div>
                            <div class="col-sm-6 mb-3">
                                <label class="form-label text-muted small mb-1">Business Name</label>
                                <p id="profile-business" class="fw-semibold mb-0">--</p>
                            </div>
                            <div class="col-sm-6 mb-3">
                                <label class="form-label text-muted small mb-1">Aadhaar Number</label>
                                <p id="profile-aadhaar" class="fw-semibold mb-0">--</p>
                            </div>
                            <div class="col-sm-6 mb-3">
                                <label class="form-label text-muted small mb-1">Business License</label>
                                <p id="profile-license" class="fw-semibold mb-0">--</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <!-- Add House Modal -->
    <div class="modal fade" id="addHouseModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title fw-bold">Add New House Listing</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addHouseForm" onsubmit="startListingPaymentFlow(event)">
                        <div class="row g-3">
                            <div class="col-md-12">
                                <label for="house-title" class="form-label">Title <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="house-title" name="title" required placeholder="e.g. Spacious 2BHK Apartment">
                            </div>
                            
                            <div class="col-md-6">
                                <label for="house-type" class="form-label">Type <span class="text-danger">*</span></label>
                                <select class="form-select" id="house-type" name="type" required onchange="updatePriceLabel()">
                                    <option value="PG">PG</option>
                                    <option value="Hostel">Hostel</option>
                                    <option value="Apartment">Apartment</option>
                                </select>
                            </div>
                            
                            <div class="col-md-6">
                                <label for="house-price" class="form-label" id="price-label">Monthly Rent <span class="text-danger">*</span></label>
                                <div class="input-group">
                                    <span class="input-group-text">₹</span>
                                    <input type="number" class="form-control" id="house-price" name="price" required min="0" step="0.01">
                                </div>
                            </div>
                            
                            <div class="col-md-12">
                                <label for="house-location" class="form-label">Location <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="house-location" name="location" required placeholder="Full Address">
                            </div>
                            
                            <div class="col-md-12">
                                <label for="house-description" class="form-label">Description <span class="text-danger">*</span></label>
                                <textarea class="form-control" id="house-description" name="description" rows="4" required placeholder="Describe amenities, rules, etc."></textarea>
                            </div>
                            
                            <div class="col-md-12">
                                <label for="house-images" class="form-label">Images <span class="text-danger">*</span></label>
                                <input type="file" class="form-control" id="house-images" name="images" multiple accept="image/jpeg, image/jpg" required>
                                <div class="form-text">Accepted format: JPG/JPEG only. At least one image required.</div>
                            </div>
                        </div>
                        
                        <div class="mt-4 text-end">
                            <button type="button" class="btn btn-secondary me-2" data-bs-dismiss="modal">Cancel</button>
                            <button type="submit" class="btn btn-primary">Submit Listing</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- View House Modal -->
    <div class="modal fade" id="viewHouseModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title fw-bold">House Listing Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-0">
                    <!-- Carousel -->
                    <div id="houseDetailsCarousel" class="carousel slide bg-light" data-bs-interval="false">
                        <div class="carousel-indicators" id="view-carousel-indicators"></div>
                        <div class="carousel-inner" id="view-carousel-inner" style="height: 350px;">
                            <!-- Items injected by JS -->
                        </div>
                        <button class="carousel-control-prev" type="button" data-bs-target="#houseDetailsCarousel" data-bs-slide="prev">
                            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                            <span class="visually-hidden">Previous</span>
                        </button>
                        <button class="carousel-control-next" type="button" data-bs-target="#houseDetailsCarousel" data-bs-slide="next">
                            <span class="carousel-control-next-icon" aria-hidden="true"></span>
                            <span class="visually-hidden">Next</span>
                        </button>
                    </div>
                    
                    <div class="p-4">
                        <div class="d-flex justify-content-between align-items-start mb-3">
                            <h3 class="fw-bold mb-0" id="view-title">--</h3>
                            <span class="badge" id="view-status">--</span>
                        </div>
                        
                        <p class="text-primary fw-bold fs-4 mb-3" id="view-price">--</p>
                        
                        <div class="row g-3 mb-4">
                            <div class="col-md-6">
                                <small class="text-muted d-block uppercase-label">Type</small>
                                <span class="fw-medium" id="view-type">--</span>
                            </div>
                            <div class="col-md-6">
                                <small class="text-muted d-block uppercase-label">Location</small>
                                <span class="fw-medium" id="view-location">--</span>
                            </div>
                            <div class="col-md-6">
                                <small class="text-muted d-block uppercase-label">Created On</small>
                                <span class="fw-medium" id="view-created">--</span>
                            </div>
                            <div class="col-md-6">
                                <small class="text-muted d-block uppercase-label">Approved On</small>
                                <span class="fw-medium" id="view-approved">--</span>
                            </div>
                        </div>
                        
                        <div>
                            <small class="text-muted d-block uppercase-label mb-1">Description</small>
                            <p class="mb-0 text-break" id="view-description">--</p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Add Tiffin Modal -->
    <div class="modal fade" id="addTiffinModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title fw-bold">Add New Tiffin Service</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addTiffinForm" onsubmit="startTiffinPaymentFlow(event)">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label for="tiffin-radius" class="form-label">Delivery Radius (km) <span class="text-danger">*</span></label>
                                <input type="number" class="form-control" id="tiffin-radius" name="delivery_radius" required min="0" step="0.1" placeholder="e.g. 5">
                            </div>
                            
                            <div class="col-md-6">
                                <label class="form-label d-block">Fast Delivery Available? <span class="text-danger">*</span></label>
                                <div class="form-check form-switch mt-2">
                                    <input class="form-check-input" type="checkbox" id="tiffin-fast-delivery" name="fast_delivery" value="true">
                                    <label class="form-check-label" for="tiffin-fast-delivery">Yes, fast delivery enabled</label>
                                </div>
                            </div>
                            
                            <div class="col-md-12">
                                <label class="form-label">Diet Type <span class="text-danger">*</span></label>
                                <div class="d-flex gap-3">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="diet_option" value="veg" id="diet-veg">
                                        <label class="form-check-label" for="diet-veg">Veg</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="diet_option" value="non-veg" id="diet-nonveg">
                                        <label class="form-check-label" for="diet-nonveg">Non-Veg</label>
                                    </div>
                                </div>
                                <input type="hidden" name="diet_type" id="tiffin-diet-type" required>
                                <div class="invalid-feedback d-block" id="diet-error" style="display: none !important;">At least one option required.</div>
                            </div>

                            <div class="col-md-12">
                                <label class="form-label">Available Days <span class="text-danger">*</span></label>
                                <div class="row row-cols-2 row-cols-md-4 g-2">
                                    <div class="col"><div class="form-check"><input class="form-check-input day-check" type="checkbox" value="Monday" id="day-mon"><label class="form-check-label" for="day-mon">Monday</label></div></div>
                                    <div class="col"><div class="form-check"><input class="form-check-input day-check" type="checkbox" value="Tuesday" id="day-tue"><label class="form-check-label" for="day-tue">Tuesday</label></div></div>
                                    <div class="col"><div class="form-check"><input class="form-check-input day-check" type="checkbox" value="Wednesday" id="day-wed"><label class="form-check-label" for="day-wed">Wednesday</label></div></div>
                                    <div class="col"><div class="form-check"><input class="form-check-input day-check" type="checkbox" value="Thursday" id="day-thu"><label class="form-check-label" for="day-thu">Thursday</label></div></div>
                                    <div class="col"><div class="form-check"><input class="form-check-input day-check" type="checkbox" value="Friday" id="day-fri"><label class="form-check-label" for="day-fri">Friday</label></div></div>
                                    <div class="col"><div class="form-check"><input class="form-check-input day-check" type="checkbox" value="Saturday" id="day-sat"><label class="form-check-label" for="day-sat">Saturday</label></div></div>
                                    <div class="col"><div class="form-check"><input class="form-check-input day-check" type="checkbox" value="Sunday" id="day-sun"><label class="form-check-label" for="day-sun">Sunday</label></div></div>
                                </div>
                                <input type="hidden" name="available_days" id="tiffin-days" required>
                                <div class="invalid-feedback d-block" id="days-error" style="display: none !important;">At least one day required.</div>
                            </div>
                            
                            <div class="col-md-12">
                                <label for="tiffin-images" class="form-label">Kitchen Images <span class="text-danger">*</span></label>
                                <input type="file" class="form-control" id="tiffin-images" name="images" multiple accept="image/jpeg, image/jpg" required>
                                <div class="form-text">Accepted format: JPG/JPEG only. At least one image required.</div>
                            </div>
                        </div>
                        
                        <div class="mt-4 text-end">
                            <button type="button" class="btn btn-secondary me-2" data-bs-dismiss="modal">Cancel</button>
                            <button type="submit" class="btn btn-primary" onclick="validateTiffinForm(event)">Submit Listing</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- View Tiffin Modal -->
    <div class="modal fade" id="viewTiffinModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title fw-bold">Tiffin Service Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-0">
                    <!-- Carousel -->
                    <div id="tiffinDetailsCarousel" class="carousel slide bg-light" data-bs-interval="false">
                        <div class="carousel-indicators" id="tiffin-carousel-indicators"></div>
                        <div class="carousel-inner" id="tiffin-carousel-inner" style="height: 350px;">
                            <!-- Items injected by JS -->
                        </div>
                        <button class="carousel-control-prev" type="button" data-bs-target="#tiffinDetailsCarousel" data-bs-slide="prev">
                            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                            <span class="visually-hidden">Previous</span>
                        </button>
                        <button class="carousel-control-next" type="button" data-bs-target="#tiffinDetailsCarousel" data-bs-slide="next">
                            <span class="carousel-control-next-icon" aria-hidden="true"></span>
                            <span class="visually-hidden">Next</span>
                        </button>
                    </div>
                    
                    <div class="p-4">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h3 class="fw-bold mb-0">Kitchen Details</h3>
                            <span class="badge" id="tiffin-view-status">--</span>
                        </div>
                        
                        <div class="row g-3">
                            <div class="col-md-6">
                                <small class="text-muted d-block uppercase-label">Delivery Radius</small>
                                <span class="fw-medium" id="tiffin-view-radius">--</span>
                            </div>
                            <div class="col-md-6">
                                <small class="text-muted d-block uppercase-label">Fast Delivery</small>
                                <span class="fw-medium" id="tiffin-view-fast">--</span>
                            </div>
                            <div class="col-md-6">
                                <small class="text-muted d-block uppercase-label">Diet Type</small>
                                <span class="fw-medium" id="tiffin-view-diet">--</span>
                            </div>
                            <div class="col-md-6">
                                <small class="text-muted d-block uppercase-label">Created On</small>
                                <span class="fw-medium" id="tiffin-view-created">--</span>
                            </div>
                            <div class="col-12">
                                <small class="text-muted d-block uppercase-label">Available Days</small>
                                <p class="fw-medium mb-0" id="tiffin-view-days">--</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Bootstrap 5 JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
    <script src="/frontend/dashboards/provider/provider-script.js?v=1"></script>
</body>
</html>
